{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Clinic360 - Messages</title>
	<link rel="icon" type="image/png" href="{% static 'logo.png' %}">
	<link rel="stylesheet" href="{% static 'messages.css' %}">
    <script src="{% static 'messages.js' %}"></script>
</head>

<body onload="loadMessagesPage()">
    <div class="header">
		<a href="{% url 'home' %}"><img src="{% static 'logo.svg' %}" alt="Clinic360 Logo" class="logo"></a>


        </a>
        <a class="anav" href="{% url 'calendar' %}" style="color: #333; display: flex; align-items: center;">
            <img src="{% static 'calendar.svg' %}" alt="Calendar Icon" style="height: 24px; margin-right: 8px;">
            Calendar
        </a>
        <a class="anav" href="#" style="color: #333; display: flex; align-items: center;">
            <img src="{% static 'message.svg' %}" alt="Messages Icon" style="height: 24px; margin-right: 8px;">
            Messages
        </a>
		<div class="user-card panel">
            <img src="{% static 'dummy-pfp.png' %}" alt="User Picture" id="user-picture">
            <span id="username">
                {{ user.first_name }} {{ user.last_name }}
            </span>
        </div>
	</div>

    <!--HTML PAGE CONTENT STARTS HERE-->
    <div class="container">
        <!-- Left Panel: Send a Message Form and Sent Messages -->
        <div class="left-panel">
            <!-- Send a Message Form -->
            <div class="message-form">
                <h3>Send a Message</h3>
                <form method="post">
                    {% csrf_token %}
                    <div>
                        <label for="receiver">Receiver:</label>
                        {{ form.receiver }}
                    </div>
                    <div>
                        <label for="content">Content:</label>
                        {{ form.content }}
                    </div>
                    <button type="submit">Send Message</button>
                </form>
            </div>
    
            <!-- Sent Messages -->
            <div class="sent-messages">
                <h3>Sent Messages</h3>
                <ul>
                    {% for message in sent_messages %}
                        <li class="message-box" onclick="showMessage('{{ message.content|escapejs }}')">
                            <div>
                                <strong>To {{ message.receiver }}</strong>
                                <span class="status">{{ message.status }}</span>
                            </div>
                            <br>
                            <span>{{ message.timestamp }}</span>
                        </li>
                    {% empty %}
                        <li>No messages sent.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    
        <!-- Right Panel: Received Messages and Past Messages -->
        <div class="right-panel">
            <!-- Received Messages -->
            <div class="messages-display">
                <h3>Received Messages</h3>
                <ul id="unreadMessages">
                    {% for message in unread_messages %}
                        <li class="message-box" data-message-id="{{ message.id }}" data-message-content="{{ message.content }}">
                            <div>
                                <strong>{{ message.sender }}</strong>
                            </div>
                            <br>
                            <span>{{ message.timestamp }}</span>
                        </li>
                    {% empty %}
                        <li>No unread messages.</li>
                    {% endfor %}
                </ul>
            </div>
            
            <!-- Past Messages Section -->
            <div class="past-messages">
                <h3>Past Messages</h3>
                <ul id="readMessages">
                    {% for message in read_messages %}
                        <li class="message-box" data-message-content="{{ message.content }}">
                            <div>
                                <strong>{{ message.sender }}</strong>
                            </div>
                            <br>
                            <span>{{ message.timestamp }}</span>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Popup Modal -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMessage()">&times;</span>
            <p id="messageContent"></p>
        </div>
    </div>
    
    
    
    

	
</body>
</html>
